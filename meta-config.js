/**
 * Global Configuration for Meta Pixel, Domain Verification, and Event Tracking (20 Pages).
 * DO NOT EDIT THIS FILE MANUALLY. It is generated by admin-config.html.
 */
// ðŸ”¥ à¸ªà¹ˆà¸§à¸™à¸™à¸µà¹‰à¸„à¸·à¸­ CONFIG_PAGES ARRAY à¸—à¸µà¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ 20 à¸Šà¸¸à¸”à¸‚à¸­à¸‡à¸„à¸¸à¸“ ðŸ”¥
// (à¹‚à¸„à¹‰à¸”à¸ˆà¸£à¸´à¸‡à¸ˆà¸°à¸šà¸£à¸£à¸ˆà¸¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ JSON à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸›à¹‰à¸­à¸™à¹€à¸‚à¹‰à¸²à¸¡à¸²)
const CONFIG_PAGES = [
    {
        "key": "page1",
        "name": "à¹€à¸§à¹‡à¸šà¸«à¸¥à¸±à¸",
        "pixelId": "906803681684641",
        "domainVerification": "y0w3wdlfmswcvmvjb4ts060brtloyq",
        "eventTracking": [
            {
                "id": "main-line-button",
                "events": [
                    {"name": "Contact"},
                    {"name": "AddToCart", "params": {"value": 100, "currency": "THB"}}
                ]
            }
        ]
    },
    {
        "key": "page2",
        "name": "à¹à¸„à¸¡à¹€à¸›à¸à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™ 1",
        "pixelId": "123456789012345",
        "domainVerification": "abcde12345fghij67890klmno2345",
        "eventTracking": [
             // ... Event Tracking JSON à¸ªà¸³à¸«à¸£à¸±à¸š Page 2 ...
        ]
    },
    // ... à¸­à¸µà¸ 18 à¸£à¸²à¸¢à¸à¸²à¸£ ...
];


/**
 * INJECTOR FUNCTION: Finds config based on data-config-key in body tag and injects Meta/FB Pixel.
 */
function injectMetaTags() {
    // 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Key à¸‚à¸­à¸‡à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¸ˆà¸²à¸ body tag
    const bodyConfigName = document.body.getAttribute('data-config-key');
    
    if (!bodyConfigName) {
        console.warn('Meta Config: Body attribute "data-config-key" not found. Cannot inject specific Pixel/Domain.');
        return;
    }

    // 2. à¸„à¹‰à¸™à¸«à¸² Config à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸ˆà¸²à¸ Array
    const pageConfig = CONFIG_PAGES.find(config => config.key === bodyConfigName);
    
    if (!pageConfig || !pageConfig.pixelId || !pageConfig.domainVerification) {
        console.error('Meta Config: Configuration not found or incomplete for key:', bodyConfigName);
        return;
    }

    const PIXEL_ID = pageConfig.pixelId;
    const DOMAIN_ID = pageConfig.domainVerification;
    
    // 3. Inject Domain Verification Meta Tag
    const domainMeta = document.createElement('meta');
    domainMeta.name = 'facebook-domain-verification';
    domainMeta.content = DOMAIN_ID;
    document.head.prepend(domainMeta);
    
    // 4. Inject Meta Pixel Base Code (Standard Setup)
    const pixelCode = `
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '${PIXEL_ID}');
    fbq('track', 'PageView');
    `;
    
    const pixelScript = document.createElement('script');
    pixelScript.textContent = pixelCode;
    document.head.appendChild(pixelScript);
    
    // Inject noscript tag
    const noscriptDiv = document.createElement('noscript');
    noscriptDiv.innerHTML = `<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=${PIXEL_ID}&ev=PageView&noscript=1" />`;
    document.head.appendChild(noscriptDiv);
    
    console.log(`Meta Config: Injected ID ${PIXEL_ID} for page key ${bodyConfigName} (${pageConfig.name})`);

    // 5. Attach Event Listeners
    attachEvents(pageConfig.eventTracking);
}

function attachEvents(eventTrackingConfig) {
    if (!eventTrackingConfig || eventTrackingConfig.length === 0) {
        return; 
    }
    
    // à¸£à¸­à¹ƒà¸«à¹‰ DOM à¹‚à¸«à¸¥à¸”à¹€à¸ªà¸£à¹‡à¸ˆà¸à¹ˆà¸­à¸™à¹à¸™à¸š Listener à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸²à¸›à¸¸à¹ˆà¸¡à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¸ˆà¸£à¸´à¸‡
    document.addEventListener('DOMContentLoaded', () => {
        if (!window.fbq) {
             console.warn('FBQ not available for event attachment.');
             return;
        }
        
        eventTrackingConfig.forEach(config => {
            const element = document.querySelector(`[data-fb-event-id="${config.id}"]`);
            if (element) {
                element.addEventListener('click', (e) => {
                    config.events.forEach(event => {
                        window.fbq('track', event.name, event.params || {});
                        console.log('FB Event Tracked:', event.name, 'for ID:', config.id);
                    });
                });
            } else {
                console.warn('FB Event Config Warning: Element not found for ID:', config.id);
            }
        });
    });
}


// Automatically call the injection function when the script loads
injectMetaTags();