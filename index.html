<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Meta Pixel/Domain Config Admin (Super AI Edition)</title>
    <style>
        /* ... (‡πÉ‡∏ä‡πâ Style ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ï‡πà‡∏ú‡∏°‡∏¢‡πà‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö) ... */
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1300px; margin: auto; background-color: #f4f4f4; color: #333; }
        #login-container { text-align: center; margin-top: 100px; padding: 30px; border: 1px solid #ccc; background-color: white; max-width: 400px; margin: 100px auto 0; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        #login-container input { padding: 10px; margin: 10px 0; width: 80%; border: 1px solid #ddd; border-radius: 4px; }
        #login-container button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .hidden { display: none; }
        h2 { color: #007bff; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
        .config-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        .config-table th, .config-table td { padding: 8px 10px; border: 1px solid #ddd; text-align: left; vertical-align: top; }
        .config-table th { background-color: #e9e9e9; font-weight: bold; }
        .config-table td:nth-child(1) { width: 15%; background-color: #f9f9f9; }
        .config-table input[type="text"] { width: 95%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-bottom: 5px; }
        .config-table textarea { width: 95%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; resize: vertical; font-family: monospace; }
        .save-button { padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; transition: background-color 0.3s; margin-top: 5px; }
        .save-button:hover { background-color: #1e7e34; }
        .status-message { margin-top: 5px; font-size: 0.8em; font-weight: bold; }
    </style>
</head>
<body>
    
    <div id="login-container">
        <h3>üîë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <input type="password" id="password-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" onkeypress="if(event.key==='Enter') authenticate()">
        <button onclick="authenticate()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <p id="login-error" style="color: red;"></p>
    </div>

    <div id="admin-content" class="hidden">
        <h2>üíª ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Meta Pixel ‡πÅ‡∏•‡∏∞ Domain Verification (Super Mode)</h2>
        
        <div style="background-color: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
            <strong>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ GitHub:</strong>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <div>
                    <label>GitHub Token:</label>
                    <input type="password" id="github-token-input" placeholder="ghp_xxxxxxxxxxxx" style="width: 100%; padding: 8px;">
                </div>
                <div>
                    <label>‡∏ä‡∏∑‡πà‡∏≠ Repo ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Target Repo):</label>
                    <input type="text" id="target-repo-input" value="linkme-suzurun" placeholder="‡πÄ‡∏ä‡πà‡∏ô linkme-suzurun" style="width: 100%; padding: 8px;">
                </div>
            </div>
            <small style="color: #666;">
                üìå Token ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (Permission) ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á 2 Repositories
            </small>
        </div>

        <table class="config-table">
            <thead>
                <tr>
                    <th>(Key ID)</th>
                    <th>Meta Pixel ID</th>
                    <th>Domain Verification ID</th>
                    <th>Event Tracking JSON</th>
                    <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="configTableBody"></tbody>
        </table>
        <div id="global-status" style="margin-top: 30px; font-size: 1.1em; font-weight: bold;"></div>
    </div>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏Å ---
        const MASTER_PASSWORD = "wooddy@8852"; 
        const GITHUB_USERNAME = "theerayutkumsri-glitch";
        const GITHUB_ADMIN_REPO = "blackup-link"; // Repo ‡∏Ç‡∏≠‡∏á Admin
        const GITHUB_CONFIG_FILE = "config.json";

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ---
        function authenticate() {
            const input = document.getElementById('password-input').value;
            if (input === MASTER_PASSWORD) {
                document.getElementById('login-container').classList.add('hidden');
                document.getElementById('admin-content').classList.remove('hidden');
                loadSettings();
                populateTable(); 
            } else {
                document.getElementById('login-error').textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            }
        }

        // --- ‡πÇ‡∏´‡∏•‡∏î/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å GitHub Token ‡πÅ‡∏•‡∏∞ Target Repo ---
        function loadSettings() {
            const token = localStorage.getItem('githubToken');
            const targetRepo = localStorage.getItem('targetRepo');
            if (token) document.getElementById('github-token-input').value = token;
            if (targetRepo) document.getElementById('target-repo-input').value = targetRepo;
        }

        document.getElementById('github-token-input').addEventListener('change', (e) => localStorage.setItem('githubToken', e.target.value));
        document.getElementById('target-repo-input').addEventListener('change', (e) => localStorage.setItem('targetRepo', e.target.value));

        // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Config Template ---
        const PAGE_CONFIGS_TEMPLATE = Array.from({length: 20}, (_, i) => ({ id: `FACEBOOK ${i+1}`, name: `Name ${i+1}` }));
        const LOCAL_STORAGE_KEY = 'metaConfig20';

        function loadAllConfigs() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            return savedData ? JSON.parse(savedData) : PAGE_CONFIGS_TEMPLATE.map(c => ({
                key: c.id, name: c.name, pixelId: '', domainVerification: '', eventTracking: []
            }));
        }

        function populateTable() {
            const tableBody = document.getElementById('configTableBody');
            const configs = loadAllConfigs();
            tableBody.innerHTML = ''; 
            
            configs.forEach(config => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>
                        <input type="text" id="name_${config.key}" value="${config.name}" class="name-input">
                        <br>(<span style="color:#007bff; font-weight: bold;">${config.key}</span>)
                    </td>
                    <td><input type="text" id="pixel_${config.key}" value="${config.pixelId}" placeholder="Pixel ID"></td>
                    <td><input type="text" id="domain_${config.key}" value="${config.domainVerification}" placeholder="Domain ID"></td>
                    <td><textarea id="event_${config.key}" rows="4">${config.eventTracking.length > 0 ? JSON.stringify(config.eventTracking, null, 4) : ''}</textarea></td>
                    <td class="action-cell">
                        <button class="save-button" onclick="handleSave('${config.key}')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡πá‡∏ö</button>
                        <div id="status_${config.key}" class="status-message"></div>
                    </td>
                `;
            });
        }

        // üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏£‡∏∞‡πÄ‡∏≠‡∏Å: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡πâ‡∏≤‡∏° Repo üî•
        async function handleSave(key) {
            const statusDiv = document.getElementById(`status_${key}`);
            const targetRepo = document.getElementById('target-repo-input').value.trim();
            const token = document.getElementById('github-token-input').value.trim();

            if (!token || !targetRepo) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ GitHub Token ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠ Target Repo ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            statusDiv.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';
            statusDiv.style.color = 'orange';

            // 1. ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á LocalStorage
            const allConfigs = loadAllConfigs();
            const newName = document.getElementById(`name_${key}`).value.trim();
            const newPixel = document.getElementById(`pixel_${key}`).value.trim();
            const newDomain = document.getElementById(`domain_${key}`).value.trim();
            let newEvent = [];
            try {
                const eventVal = document.getElementById(`event_${key}`).value.trim();
                if(eventVal) newEvent = JSON.parse(eventVal);
            } catch(e) {
                statusDiv.textContent = '‚ùå JSON Event ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'; return;
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Array
            const index = allConfigs.findIndex(c => c.key === key);
            if(index !== -1) {
                allConfigs[index] = { key, name: newName, pixelId: newPixel, domainVerification: newDomain, eventTracking: newEvent };
            }
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(allConfigs));

            try {
                // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå config.json (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pixel)
                await updateFileInGithub(GITHUB_ADMIN_REPO, GITHUB_CONFIG_FILE, JSON.stringify({ CONFIG_PAGES: allConfigs }, null, 2), token);
                
                // 3. üî• ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå index.html ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Domain Verification) üî•
                if (newDomain) {
                    statusDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö...';
                    await injectDomainToTargetHtml(targetRepo, newDomain, token);
                }

                statusDiv.textContent = '‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠ Vercel ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï 2 ‡∏ô‡∏≤‡∏ó‡∏µ';
                statusDiv.style.color = 'green';
                alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n1. Pixel ID: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ\n2. Domain ID: ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô index.html ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß\n\n‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2-3 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÉ‡∏´‡πâ Vercel ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î Verify ‡πÉ‡∏ô Facebook`);

            } catch (error) {
                console.error(error);
                statusDiv.textContent = `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
                statusDiv.style.color = 'red';
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        async function updateFileInGithub(repo, filename, content, token) {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${repo}/contents/${filename}`;
            // Get SHA
            const getRes = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
            let sha = null;
            if (getRes.ok) {
                const data = await getRes.json();
                sha = data.sha;
            }
            // Put
            const putRes = await fetch(url, {
                method: 'PUT',
                headers: { 
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Admin Auto-Update',
                    content: btoa(unescape(encodeURIComponent(content))),
                    sha: sha,
                    branch: 'main'
                })
            });
            if (!putRes.ok) throw new Error('GitHub Update Failed');
        }

        // üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ Meta Tag ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå HTML üî•
        async function injectDomainToTargetHtml(repo, newDomainId, token) {
            const filename = 'index.html';
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${repo}/contents/${filename}`;
            
            // 1. ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô
            const getRes = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
            if (!getRes.ok) throw new Error(`‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå index.html ‡πÉ‡∏ô Repo ${repo} ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠`);
            
            const data = await getRes.json();
            const oldContent = decodeURIComponent(escape(atob(data.content))); // Decode Base64
            
            // 2. ‡πÉ‡∏ä‡πâ Regex ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà Meta Tag
            // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏´‡∏≤: <meta name="facebook-domain-verification" content="..." />
            const regex = /<meta\s+name=["']facebook-domain-verification["']\s+content=["'][^"']*["']\s*\/?>/i;
            const newTag = `<meta name="facebook-domain-verification" content="${newDomainId}" />`;
            
            let newContent;
            if (regex.test(oldContent)) {
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà
                newContent = oldContent.replace(regex, newTag);
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏£‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô <head>
                newContent = oldContent.replace('</head>', `    ${newTag}\n</head>`);
            }

            if (newContent === oldContent) return; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ã‡∏ü

            // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
            const putRes = await fetch(url, {
                method: 'PUT',
                headers: { 
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Admin Auto-Inject Domain Verification: ${newDomainId}`,
                    content: btoa(unescape(encodeURIComponent(newContent))),
                    sha: data.sha,
                    branch: 'main'
                })
            });
            
            if (!putRes.ok) throw new Error('Failed to inject HTML');
        }
    </script>
</body>
</html>