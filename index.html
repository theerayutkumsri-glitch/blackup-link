<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Meta Pixel/Domain Config Admin (LOCKED)</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1300px; margin: auto; background-color: #f4f4f4; color: #333; }
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô */
        #login-container { text-align: center; margin-top: 100px; padding: 30px; border: 1px solid #ccc; background-color: white; max-width: 400px; margin: 100px auto 0; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        #login-container input { padding: 10px; margin: 10px 0; width: 80%; border: 1px solid #ddd; border-radius: 4px; }
        #login-container button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .hidden { display: none; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Admin ‡πÄ‡∏î‡∏¥‡∏° */
        h2 { color: #007bff; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
        .config-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        .config-table th, .config-table td { padding: 8px 10px; border: 1px solid #ddd; text-align: left; vertical-align: top; }
        .config-table th { background-color: #e9e9e9; font-weight: bold; }
        .config-table td:nth-child(1) { width: 15%; background-color: #f9f9f9; }
        .config-table input[type="text"] { width: 95%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-bottom: 5px; }
        .config-table textarea { width: 95%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; resize: vertical; font-family: monospace; }
        .name-input { font-weight: bold; }
        .action-cell { width: 15%; text-align: center; }
        .save-button { padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; transition: background-color 0.3s; margin-top: 5px; }
        .save-button:hover { background-color: #1e7e34; }
        .status-message { margin-top: 5px; font-size: 0.8em; font-weight: bold; }
        .note { color: #555; font-style: italic; margin-bottom: 20px; }
    </style>
</head>
<body>
    
    <div id="login-container">
        <h3>üîë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <input type="password" id="password-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" onkeypress="if(event.key==='Enter') authenticate()">
        <button onclick="authenticate()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <p id="login-error" style="color: red;"></p>
    </div>

    <div id="admin-content" class="hidden">
        <h2>üíª ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Meta Pixel ‡πÅ‡∏•‡∏∞ Domain Verification</h2>
        <div style="background-color: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
            <strong>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GitHub Token:</strong>
            <input type="password" id="github-token-input" placeholder="‡πÉ‡∏™‡πà GitHub Personal Access Token" style="width: 400px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; display: block;">
            <small style="color: #666;">
                üìå <a href="https://github.com/settings/tokens" target="_blank">‡∏™‡∏£‡πâ‡∏≤‡∏á Token ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a> (Permissions: repo) 
                | üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô LocalStorage (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå)
            </small>
        </div>

        <table class="config-table">
            <thead>
                <tr>
                    <th>(Key ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Body)</th>
                    <th>Meta Pixel ID</th>
                    <th>Domain Verification ID</th>
                    <th>Event Tracking JSON</th>
                    <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="configTableBody">
                </tbody>
        </table>

        <div id="global-status" style="margin-top: 30px; font-size: 1.1em; font-weight: bold;"></div>
    </div>


    <script>
        // üî• ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î üî•
        const MASTER_PASSWORD = "wooddy@8852"; // **** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ****
        
        // GitHub Configuration
        const GITHUB_USERNAME = "theerayutkumsri-glitch";
        const GITHUB_REPO = "blackup-link";
        const GITHUB_CONFIG_FILE = "config.json";
        const GITHUB_TOKEN_STORAGE_KEY = "githubToken";

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        function authenticate() {
            const input = document.getElementById('password-input').value;
            const error = document.getElementById('login-error');

            if (input === MASTER_PASSWORD) {
                document.getElementById('login-container').classList.add('hidden');
                document.getElementById('admin-content').classList.remove('hidden');
                error.textContent = '';
                // ‡πÇ‡∏´‡∏•‡∏î GitHub Token ‡∏à‡∏≤‡∏Å LocalStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                loadGithubToken();
                populateTable(); 
            } else {
                error.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            }
        }
        
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å populateTable ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ authenticate() ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', () => {
             // ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å populateTable() ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß
        });
        
        // ------------------------------------------------------------------
        // üî• GitHub Token Management üî•
        // ------------------------------------------------------------------
        
        function loadGithubToken() {
            const savedToken = localStorage.getItem(GITHUB_TOKEN_STORAGE_KEY);
            if (savedToken) {
                document.getElementById('github-token-input').value = savedToken;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const tokenInput = document.getElementById('github-token-input');
            if (tokenInput) {
                tokenInput.addEventListener('change', (e) => {
                    if (e.target.value.trim()) {
                        localStorage.setItem(GITHUB_TOKEN_STORAGE_KEY, e.target.value.trim());
                        alert('‚úÖ GitHub Token ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                    }
                });
            }
        });
        
        // ------------------------------------------------------------------
        // üî• GitHub API Functions üî•
        // ------------------------------------------------------------------
        
        async function pushConfigToGithub(newConfigs, statusDiv) {
            const token = document.getElementById('github-token-input').value.trim();
            
            if (!token) {
                statusDiv.textContent = '‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà GitHub Token ‡∏Å‡πà‡∏≠‡∏ô';
                statusDiv.style.color = 'red';
                return false;
            }
            
            try {
                statusDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á GitHub...';
                statusDiv.style.color = '#0056b3';
                
                // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á config.json content
                const configContent = {
                    CONFIG_PAGES: newConfigs
                };
                
                const configJson = JSON.stringify(configContent, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(configJson)));
                
                // 2. ‡∏î‡∏∂‡∏á SHA ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏û‡∏∑‡πà‡∏≠ update)
                const getFileUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${GITHUB_CONFIG_FILE}`;
                const getResponse = await fetch(getFileUrl, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github+json'
                    }
                });
                
                let sha = null;
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                } else if (getResponse.status === 404) {
                    // ‡πÑ‡∏ü‡∏•‡πå‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                    sha = null;
                } else {
                    throw new Error(`Failed to fetch file info: ${getResponse.status}`);
                }
                
                // 3. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå
                const updateFileUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${GITHUB_CONFIG_FILE}`;
                const updatePayload = {
                    message: `Update config.json - ${new Date().toLocaleString('th-TH')}`,
                    content: encodedContent,
                    branch: 'main'
                };
                
                if (sha) {
                    updatePayload.sha = sha;
                }
                
                const updateResponse = await fetch(updateFileUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatePayload)
                });
                
                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json();
                    throw new Error(errorData.message || `Failed to update file: ${updateResponse.status}`);
                }
                
                statusDiv.textContent = `‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á GitHub ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
                statusDiv.style.color = 'green';
                document.getElementById('global-status').textContent = `‚ú® ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï config.json ‡πÉ‡∏ô GitHub ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ì ‡πÄ‡∏ß‡∏•‡∏≤ ${new Date().toLocaleTimeString('th-TH')}`;
                
                return true;
            } catch (error) {
                console.error('GitHub API Error:', error);
                statusDiv.textContent = `‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
                statusDiv.style.color = 'red';
                return false;
            }
        }
        
        // ------------------------------------------------------------------
        // üî• ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Admin ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î üî•
        // ------------------------------------------------------------------

        const LOCAL_STORAGE_KEY = 'metaConfig20';
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÉ‡∏ä‡πâ ID ‡πÄ‡∏õ‡πá‡∏ô KEY ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
        const PAGE_CONFIGS_TEMPLATE = [
            { id: 'FACEBOOK 1', name: 'Name 1' },
            { id: 'FACEBOOK 2', name: 'Name 2' },
            { id: 'FACEBOOK 3', name: 'Name 3' },
            { id: 'FACEBOOK 4', name: 'Name 4' },
            { id: 'FACEBOOK 5', name: 'Name 5' },
            { id: 'FACEBOOK 6', name: 'Name 6' },
            { id: 'FACEBOOK 7', name: 'Name 7' },
            { id: 'FACEBOOK 8', name: 'Name 8' },
            { id: 'FACEBOOK 9', name: 'Name 9' },
            { id: 'FACEBOOK 10', name: 'Name 10' },
            { id: 'FACEBOOK 11', name: 'Name 11' },
            { id: 'FACEBOOK 12', name: 'Name 12' },
            { id: 'FACEBOOK 13', name: 'Name 13' },
            { id: 'FACEBOOK 14', name: 'Name 14' },
            { id: 'FACEBOOK 15', name: 'Name 15' },
            { id: 'FACEBOOK 16', name: 'Name 16' },
            { id: 'FACEBOOK 17', name: 'Name 17' },
            { id: 'FACEBOOK 18', name: 'Name 18' },
            { id: 'FACEBOOK 19', name: 'Name 19' },
            { id: 'FACEBOOK 20', name: 'Name 20' }
        ];

        // ‡πÇ‡∏Ñ‡πâ‡∏î JSON ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Placeholder
        const EVENT_PLACEHOLDER = JSON.stringify([
            {
                "id": "line-signup-button",
                "events": [
                    {"name": "Contact"},
                    {"name": "AddToCart"}
                ]
            }
        ], null, 4).replace(/"/g, "'");

        function loadAllConfigs() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedData) {
                return JSON.parse(savedData);
            }
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            return PAGE_CONFIGS_TEMPLATE.map(config => ({
                key: config.id,
                name: config.name,
                pixelId: '',
                domainVerification: '',
                eventTracking: []
            }));
        }

        function populateTable() {
            const tableBody = document.getElementById('configTableBody');
            const configs = loadAllConfigs();
            
            tableBody.innerHTML = ''; 
            
            configs.forEach(config => {
                const row = tableBody.insertRow();
                const eventJsonValue = config.eventTracking.length > 0 
                    ? JSON.stringify(config.eventTracking, null, 4).replace(/"/g, "'") 
                    : '';
                
                row.innerHTML = `
                    <td>
                        <input type="text" id="name_${config.key}" value="${config.name}" class="name-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                        (<span style="color:#007bff; font-weight: bold;">${config.key}</span>)
                    </td>
                    <td><input type="text" id="pixel_${config.key}" value="${config.pixelId}" placeholder="Pixel ID"></td>
                    <td><input type="text" id="domain_${config.key}" value="${config.domainVerification}" placeholder="Domain ID"></td>
                    <td>
                        <textarea id="event_${config.key}" rows="4" placeholder="${EVENT_PLACEHOLDER}" style="width:100%;">${eventJsonValue}</textarea>
                    </td>
                    <td class="action-cell">
                        <button class="save-button" onclick="saveSingleConfig('${config.key}')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå</button>
                        <div id="status_${config.key}" class="status-message"></div>
                    </td>
                `;
            });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Key ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á 20 ‡∏ä‡∏∏‡∏î
        function saveSingleConfig(configKeyToUpdate) {
            const rowStatusDiv = document.getElementById(`status_${configKeyToUpdate}`);
            rowStatusDiv.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            rowStatusDiv.style.color = '#0056b3';

            const allConfigs = loadAllConfigs();
            let isValid = true;
            let firstError = '';
            
            // 1. ‡∏ß‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Input Fields ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const newConfigs = allConfigs.map(config => {
                const currentKey = config.key;
                
                const newName = document.getElementById(`name_${currentKey}`).value.trim(); 
                const pixelId = document.getElementById(`pixel_${currentKey}`).value.trim();
                const domainVerification = document.getElementById(`domain_${currentKey}`).value.trim();
                const eventConfigRaw = document.getElementById(`event_${currentKey}`).value.trim();
                
                let eventConfigJson = [];
                let currentConfigIsValid = true;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                if (currentKey === configKeyToUpdate) {
                    if (!pixelId || !domainVerification) {
                        currentConfigIsValid = false;
                        isValid = false;
                        if (!firstError) firstError = `Pixel ID/Domain ID ‡∏Ç‡∏≠‡∏á ${newName} ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô`;
                    }
                }

                if (eventConfigRaw) {
                    try {
                        eventConfigJson = JSON.parse(eventConfigRaw.replace(/'/g, '"'));
                    } catch (e) {
                        currentConfigIsValid = false;
                        isValid = false;
                        if (!firstError) firstError = `‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Event JSON ‡∏Ç‡∏≠‡∏á ${newName} ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;
                    }
                }
                
                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Config ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å Input ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                return {
                    key: currentKey,
                    name: newName,
                    pixelId: pixelId,
                    domainVerification: domainVerification,
                    eventTracking: eventConfigJson 
                };
            });

            if (!isValid) {
                rowStatusDiv.textContent = `‚ùå ${firstError}`;
                rowStatusDiv.style.color = 'red';
                return;
            }
            
            // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á 20 ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏•‡∏á Local Storage
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newConfigs));

            // 3. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï config.json ‡πÑ‡∏õ GitHub
            pushConfigToGithub(newConfigs, rowStatusDiv);
        }


        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î meta-config.js (Logic)
        function generateMetaConfigJS(allConfigs) {
            const configJson = JSON.stringify(allConfigs, null, 4);

            return `
/**
 * Global Configuration for Meta Pixel, Domain Verification, and Event Tracking (20 Pages).
 * DO NOT EDIT THIS FILE MANUALLY. It is generated by admin-config.html.
 */
const CONFIG_PAGES = ${configJson};

/**
 * INJECTOR FUNCTION: Finds config based on data-config-key in body tag and injects Meta/FB Pixel.
 */
function injectMetaTags() {
    const bodyConfigName = document.body.getAttribute('data-config-key');
    
    if (!bodyConfigName) {
        console.warn('Meta Config: Body attribute "data-config-key" not found. Cannot inject specific Pixel/Domain.');
        return;
    }

    const pageConfig = CONFIG_PAGES.find(config => config.key === bodyConfigName);
    
    if (!pageConfig || !pageConfig.pixelId || !pageConfig.domainVerification) {
        console.error('Meta Config: Configuration not found or incomplete for key:', bodyConfigName);
        return;
    }

    const PIXEL_ID = pageConfig.pixelId;
    const DOMAIN_ID = pageConfig.domainVerification;
    
    // 1. Inject Domain Verification Meta Tag
    const domainMeta = document.createElement('meta');
    domainMeta.name = 'facebook-domain-verification';
    domainMeta.content = DOMAIN_ID;
    document.head.prepend(domainMeta);
    
    // 2. Inject Meta Pixel Base Code (Standard Setup)
    const pixelCode = \`
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '\${PIXEL_ID}');
    fbq('track', 'PageView');
    \`;
    
    const pixelScript = document.createElement('script');
    pixelScript.textContent = pixelCode;
    document.head.appendChild(pixelScript);
    
    // Inject noscript tag
    const noscriptDiv = document.createElement('noscript');
    noscriptDiv.innerHTML = \`<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=\${PIXEL_ID}&ev=PageView&noscript=1" />\`;
    document.head.appendChild(noscriptDiv);
    
    console.log(\`Meta Config: Injected ID \${PIXEL_ID} for page key \${bodyConfigName} (\${pageConfig.name})\`);

    // 3. Attach Event Listeners
    attachEvents(pageConfig.eventTracking);
}

function attachEvents(eventTrackingConfig) {
    if (!eventTrackingConfig || eventTrackingConfig.length === 0) {
        return; 
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        if (!window.fbq) {
             console.warn('FBQ not available for event attachment.');
             return;
        }
        
        eventTrackingConfig.forEach(config => {
            const element = document.querySelector(\`[data-fb-event-id="\${config.id}"]\`);
            if (element) {
                element.addEventListener('click', (e) => {
                    config.events.forEach(event => {
                        window.fbq('track', event.name, event.params || {});
                        console.log('FB Event Tracked:', event.name, 'for ID:', config.id);
                    });
                });
            } else {
                console.warn('FB Event Config Warning: Element not found for ID:', config.id);
            }
        });
    });
}


// Automatically call the injection function
injectMetaTags();
`;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (load/download)
        function downloadConfig(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>